@model distribution_copy.Models.InputModel
@{
    Layout = "~/Views/Shared/_DashBoard.cshtml";
}
@{
    ViewBag.Title = "Index";
}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<div align="center">
    <label for="orgsDropdown" style="margin-top:50px;"><b>Organisations</b></label>
    <select class="form-control" id="org" name="departmentsDropdown"></select>
</div>

<div class="ml-5">

    @Html.Label("Work Item Type", htmlAttributes: new { @class = "control-label  display-4 sizeNormal", style = "padding-right:21px" })

    @Html.DropDownListFor(model => model.WorkItemType, new SelectList(new[] { "Empty List" }), htmlAttributes: new { @class = "form-control borderRadius width", id = "WorkItemType", style = "opacity:0.8" })

    @Html.ValidationMessageFor(model => model.WorkItemType, "", new { @class = "text-danger" })

</div>

<script>


    //Ajax Call to fetch Organization
    $(document).ready(function () {
        $.ajax({
            type: 'get',
            dataType: 'json',
            url: '@Url.Action("AccountList","Account")',
            success: function (data) {
                var s = '<option value="0">--Choose Organisation--</option>';
                $("#org").empty();
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].accountName + '">' + data[i].accountName + '</option>';
                }
                $("#org").append(s);
            }
        });

        $('#org').change(function () {

            var Org = $('#org').val();

            $.ajax({
                type: 'get',
                dataType: 'json',
                data: { 'organisation': Org },
                url: '@Url.Action("report","OrgReports")',
                success: function (data) {

                }
            });

            //Fetching the Dropdown workitem types
            var inp = new Object();
            inp.OrganizationName = Org;
            if (inp.OrganizationName != null) {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("WITypes", "Account")',
                    data: { inp },

                    success:
                        function (data) {
                            console.log(data);
                            document.getElementById("WorkItemType").innerHTML = "<option value='0' >--ALL--</option>";
                            for (let i = 0; i < data.length; i++) {
                                document.getElementById("WorkItemType").innerHTML += "<option value='" + data[i] + "'>" + data[i] + "</option>";
                            }

                        },
                    failure:
                        function () { alert("Something went wrong"); }

                });
            }
            else {
                return;
            }

        })

        $('#WorkItemType').change(function () {
            var Org = $('#org').val();
            var WIType = $('#WorkItemType').val();

            console.log(WIType);
            console.log(Org);

            $.ajax({
                type: 'Post',
                dataType: 'json',
                data: { 'organisation': Org, 'workitemtype': WIType },
                url: '@Url.Action("AllWorkitemsCountByType","OrgReports")',
                success: function (data) {

                }
            });
        });
            
    });

        
    //On Change of WorkItemType goto Controller AllWorkitemsCountByType
        //Author: Ravivarma (12-03-2020)

</script>


